name: Update Lineups

on:
  schedule:
    # Alle 30 Minuten
    - cron: '*/30 * * * *'
  workflow_dispatch:  # Manuell auslösbar

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    # Workflow wird nicht als fehlgeschlagen markiert, wenn einzelne Uploads fehlschlagen
    # (temporäre GitHub-Fehler werden beim nächsten Lauf automatisch behoben)
    continue-on-error: false
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install Dependencies
        run: |
          pip install requests beautifulsoup4
      
      - name: Scrape Lineups
        run: |
          cd scraper
          python scrape_lineups.py
      
      - name: Upload Lineups to GitHub
        env:
          # WICHTIG: Für externe Repositories (florianschommers/AnstossScraper) benötigt man einen Personal Access Token (PAT)
          # Der Standard GITHUB_TOKEN hat nur Zugriff auf das aktuelle Repository
          # 
          # Einrichtung:
          # 1. GitHub → Settings → Developer settings → Personal access tokens → Tokens (classic)
          # 2. Neuen Token mit 'repo' Berechtigung erstellen (ohne Ablaufzeit für dauerhafte Nutzung)
          # 3. Token als Secret 'ANSTOSS_SCRAPER_TOKEN' im Repository speichern:
          #    Repository → Settings → Secrets and variables → Actions → New repository secret
          GITHUB_TOKEN: ${{ secrets.ANSTOSS_SCRAPER_TOKEN || secrets.GITHUB_TOKEN }}
        run: |
          python upload_lineups_to_github.py

